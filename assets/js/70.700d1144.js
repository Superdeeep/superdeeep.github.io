(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{422:function(s,t,a){"use strict";a.r(t);var e=a(0),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("⚠️致读者⚠️")]),s._v(" "),t("p",[s._v("🚧本文正在施工中ing...🚧")]),s._v(" "),t("p",[s._v("错误多，不规范，比较混乱，请见谅！")])]),s._v(" "),t("p",[s._v("apt policy")]),s._v(" "),t("p",[t("strong",[s._v("更新源")])]),s._v(" "),t("p",[t("code",[s._v("apt update")])]),s._v(" "),t("p",[s._v("看一下有没有Python")]),s._v(" "),t("p",[t("code",[s._v("python3 -V")])]),s._v(" "),t("p",[t("strong",[s._v("设置主机名")])]),s._v(" "),t("p",[t("code",[s._v("hostnamectl set-hostname computer124")])]),s._v(" "),t("p",[t("strong",[s._v("设置 netplan 静态IP")])]),s._v(" "),t("p",[s._v("如果你用了别的网络管理器,请注意,不要让他们打架")]),s._v(" "),t("p",[t("code",[s._v("sudo vi /etc/netplan/01-network-manager-all.yaml")])]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Let NetworkManager manage all devices on this system")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("renderer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NetworkManager\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This is the network config written by 'subiquity'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ethernets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("eth0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dhcp4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("eth1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dhcp4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("addresses")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 192.168.2.24/24\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])])]),t("p",[t("strong",[s._v("应用netplan设置")])]),s._v(" "),t("p",[t("code",[s._v("sudo netplan apply")])]),s._v(" "),t("p",[t("strong",[s._v("配置hosts")])]),s._v(" "),t("p",[s._v("计算节点和控制节点都要配置")]),s._v(" "),t("p",[t("code",[s._v("vim /etc/hosts")])]),s._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[s._v("192.168.2.24  controller124\n192.168.2.25  computer124\n")])])]),t("p",[s._v("sudo apt update\nsudo apt install ntp")]),s._v(" "),t("p",[s._v("sudo systemctl restart ntp")]),s._v(" "),t("p",[s._v("sudo systemctl restart ntp")]),s._v(" "),t("p",[s._v("ntpq -p")]),s._v(" "),t("p",[t("strong",[s._v("安装mariadb数据库")]),s._v("(mysql的分支)")]),s._v(" "),t("p",[t("code",[s._v("sudo apt install mariadb-server mariadb-client python3-pymysql")])]),s._v(" "),t("p",[s._v("ps:")]),s._v(" "),t("p",[s._v("可以不要mariadb-client")]),s._v(" "),t("p",[s._v("用python3-pymysql就好,不用python2")]),s._v(" "),t("p",[t("strong",[s._v("数据库配置")])]),s._v(" "),t("p",[t("code",[s._v("vi /etc/mysql/mariadb.conf.d/24-openstack.cnf")])]),s._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("mysqld")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("bind-address")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("0.0.0.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("default-storage-engine")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("innodb")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("innodb_file_per_table")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("on")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("max_connections")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("4096")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("collation-server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("utf8_general_ci")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("character-set-server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("utf8")]),s._v("\n")])])]),t("p",[t("strong",[s._v("重启数据库服务")])]),s._v(" "),t("p",[t("code",[s._v("sudo systemctl restart mariadb")])]),s._v(" "),t("p",[t("strong",[s._v("设置开机启动")])]),s._v(" "),t("p",[t("code",[s._v("sudo systemctl enable mariadb")])]),s._v(" "),t("p",[t("strong",[s._v("初始化数据库")]),s._v(",一路yes 密码设置为123456")]),s._v(" "),t("p",[t("code",[s._v("sudo mysql_secure_installation")])]),s._v(" "),t("h2",{attrs:{id:"安装message-queue"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装message-queue"}},[s._v("#")]),s._v(" 安装Message queue")]),s._v(" "),t("br"),s._v(" "),t("p",[t("strong",[s._v("安装rabbitmq-server")])]),s._v(" "),t("p",[t("code",[s._v("sudo apt install rabbitmq-server")])]),s._v(" "),t("p",[t("strong",[s._v("启动rabbitmq并设置开机启动")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" rabbitmq-server\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start rabbitmq-server\n")])])]),t("p",[t("strong",[s._v("添加用户")])]),s._v(" "),t("p",[t("code",[s._v("sudo rabbitmqctl add_user openstack RABBIT_PASS")])]),s._v(" "),t("p",[t("strong",[s._v("设置权限")])]),s._v(" "),t("p",[t("code",[s._v('sudo rabbitmqctl set_permissions openstack ".*" ".*" ".*"')])]),s._v(" "),t("p",[t("strong",[s._v("加个插件")])]),s._v(" "),t("p",[t("code",[s._v("sudo rabbitmq-plugins enable rabbitmq_management")])]),s._v(" "),t("p",[t("strong",[s._v("安装Memcached")])]),s._v(" "),t("p",[t("code",[s._v("sudo apt install memcached python3-memcache")])]),s._v(" "),t("p",[t("code",[s._v("vi /etc/memcached.conf")])]),s._v(" "),t("p",[t("code",[s._v("-l 127.0.0.1,::1,192.168.2.24")])]),s._v(" "),t("p",[s._v("ps:192.168.2.24替换为你的控制节点的管理IP地址")]),s._v(" "),t("p",[t("strong",[s._v("重启服务")])]),s._v(" "),t("p",[t("code",[s._v("sudo systemctl restart memcached")])]),s._v(" "),t("p",[s._v("sudo vim /usr/lib/systemd/system/memcached.service    # 修改 Memcached 启动脚本 修改了参数 注意")]),s._v(" "),t("p",[s._v("sudo systemctl daemon-reload")]),s._v(" "),t("p",[s._v("sudo systemctl restart memcached")]),s._v(" "),t("p",[s._v("systemctl status memcached")]),s._v(" "),t("p",[s._v("sudo apt install etcd")]),s._v(" "),t("p",[s._v("sudo vi /etc/default/etcd")]),s._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("ETCD_LISTEN_PEER_URLS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("http://192.168.2.24:2380")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("ETCD_LISTEN_CLIENT_URLS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("http://192.168.2.24:2379")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("ETCD_INITIAL_ADVERTISE_PEER_URLS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("http://192.168.2.24:2380")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("ETCD_ADVERTISE_CLIENT_URLS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("http://192.168.2.24:2379")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("ETCD_INITIAL_CLUSTER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("controller=http://192.168.2.24:2380")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("ETCD_INITIAL_CLUSTER_TOKEN")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("etcd-cluster-01")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("ETCD_INITIAL_CLUSTER_STATE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("new")]),s._v('"')]),s._v("\n")])])]),t("p",[s._v("sudo systemctl restart etcd")]),s._v(" "),t("p",[s._v("sudo systemctl enable etcd")]),s._v(" "),t("p",[s._v("sudo systemctl start etcd")]),s._v(" "),t("p",[s._v("vim /usr/local/bin/opst-proc-show.sh")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/env bash")]),s._v("\nsystemctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-E")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UNIT|chronyd|memcached|rabbitmq|mariadb|glance|httpd\\.s|etcd|nova|neutron|libvirtd\\.ser"')]),s._v("\n")])])]),t("p",[s._v("chmod u+x /usr/local/bin/opst-proc-show.sh")]),s._v(" "),t("p",[s._v("bash opst-proc-show.sh")]),s._v(" "),t("p",[s._v("sudo reboot")]),s._v(" "),t("p",[s._v("bash opst-proc-show.sh")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u root "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DATABASE")]),s._v(" keystone"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" keystone"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'keystone'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'localhost'")]),s._v(" IDENTIFIED "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'KEYSTONE_DBPASS'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" keystone"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'keystone'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" IDENTIFIED "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'KEYSTONE_DBPASS'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" keystone"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])])]),t("p",[s._v("sudo apt install keystone")]),s._v(" "),t("p",[s._v("sudo vi /etc/keystone/keystone.conf")]),s._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("database")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("connection")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("mysql+pymysql://keystone:KEYSTONE_DBPASS@controller124/keystone")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("token")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("provider")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("fernet")]),s._v("\n")])])]),t("p",[s._v("sudo keystone-manage db_sync")]),s._v(" "),t("p",[s._v("sudo keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone")]),s._v(" "),t("p",[s._v("sudo keystone-manage credential_setup --keystone-user keystone --keystone-group keystone")]),s._v(" "),t("p",[s._v("sudo keystone-manage bootstrap --bootstrap-password ADMIN_PASS "),t("br"),s._v("\n--bootstrap-admin-url http://controller124:5000/v3/ "),t("br"),s._v("\n--bootstrap-internal-url http://controller124:5000/v3/ "),t("br"),s._v("\n--bootstrap-public-url http://controller124:5000/v3/ "),t("br"),s._v("\n--bootstrap-region-id RegionOne")]),s._v(" "),t("p",[s._v("sudo vi /etc/apache2/apache2.conf")]),s._v(" "),t("p",[s._v("sudo systemctl enable apache2")]),s._v(" "),t("p",[s._v("sudo systemctl restart apache2")]),s._v(" "),t("p",[s._v("export OS_USERNAME=admin\nexport OS_PASSWORD=ADMIN_PASS\nexport OS_PROJECT_NAME=admin\nexport OS_USER_DOMAIN_NAME=Default\nexport OS_PROJECT_DOMAIN_NAME=Default\nexport OS_AUTH_URL=http://controller124:5000/v3\nexport OS_IDENTITY_API_VERSION=3")]),s._v(" "),t("p",[s._v("source admin-openrc.sh")]),s._v(" "),t("p",[s._v("openstack user list")]),s._v(" "),t("p",[s._v("openstack --os-auth-url http://controller124:5000/v3 "),t("br"),s._v("\n--os-project-domain-name Default --os-user-domain-name Default "),t("br"),s._v("\n--os-project-name admin --os-username admin token issue")]),s._v(" "),t("p",[s._v("unset OS_PROJECT_DOMAIN_NAME\nunset OS_USER_DOMAIN_NAME\nunset OS_PROJECT_NAME\nunset OS_USERNAME\nunset OS_PASSWORD\nunset OS_AUTH_URL\nunset OS_IDENTITY_API_VERSION\nunset OS_IMAGE_API_VERSION")]),s._v(" "),t("p",[s._v("fish shell")]),s._v(" "),t("p",[s._v("set -e OS_PROJECT_DOMAIN_NAME\nset -e OS_USER_DOMAIN_NAME\nset -e OS_PROJECT_NAME\nset -e OS_USERNAME\nset -e OS_PASSWORD\nset -e OS_AUTH_URL\nset -e OS_IDENTITY_API_VERSION\nset -e OS_IMAGE_API_VERSION")]),s._v(" "),t("p",[s._v("openstack --os-auth-url http://controller124:5000/v3 "),t("br"),s._v("\n--os-project-domain-name default --os-user-domain-name default "),t("br"),s._v("\n--os-project-name admin --os-username admin --os-auth-type password "),t("br"),s._v("\n--os-password ADMIN_PASS token issue")]),s._v(" "),t("p",[s._v("fish shell file")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/env fish")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OS_USERNAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OS_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ADMIN_PASS\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OS_PROJECT_NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OS_USER_DOMAIN_NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Default\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OS_PROJECT_DOMAIN_NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Default\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OS_AUTH_URL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://controller124:5000/v3\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OS_IDENTITY_API_VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])])]),t("p",[s._v('openstack service list |grep -E "ID|keystone"')]),s._v(" "),t("p",[s._v('openstack endpoint list |grep -E "ID|keystone"')]),s._v(" "),t("p",[s._v("glance install")]),s._v(" "),t("p",[s._v("sudo apt install glance")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u root "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" glance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'glance'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'localhost'")]),s._v(" \\\n  IDENTIFIED "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GLANCE_DBPASS'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" glance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'glance'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" \\\n  IDENTIFIED "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GLANCE_DBPASS'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/keystone/admin-openrc\n\n\nopenstack user create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--domain")]),s._v(" default "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),s._v(" GLANCE_PASS glance\n\n\nopenstack project create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--domain")]),s._v(" default "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--description")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Service Project"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\nopenstack role "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--project")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--user")]),s._v(" glance admin\nopenstack user create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--domain")]),s._v(" default "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),s._v(" MY_PASSWORD MY_SERVICE\n\n\n\nopenstack role "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--user")]),s._v(" MY_SERVICE --user-domain Default "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--system")]),s._v(" all reader\n\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("openstack "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" glance "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--description")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OpenStack Image"')]),s._v(" image\n\nopenstack endpoint create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--region")]),s._v(" RegionOne "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  image public http://controller124:9292\n\nopenstack endpoint create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--region")]),s._v(" RegionOne "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  image internal http://controller124:9292\n\nopenstack endpoint create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--region")]),s._v(" RegionOne "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  image admin http://controller124:9292\n")])])]),t("p",[s._v("glance-api.conf")]),s._v(" "),t("p",[s._v("sudo su")]),s._v(" "),t("p",[s._v("cd /etc/glance")]),s._v(" "),t("p",[s._v('su -s /bin/sh -c "glance-manage db_sync" glance')]),s._v(" "),t("p",[s._v("mysql -u glance -p\npassword: GLANCE_DBPASS")]),s._v(" "),t("p",[s._v("use glance;\nshow tables;\nexit;")]),s._v(" "),t("p",[s._v("systemctl restart glance-api")]),s._v(" "),t("p",[s._v("sudo systemctl enable glance-api")]),s._v(" "),t("p",[s._v("sudo systemctl status glance-api")]),s._v(" "),t("p",[s._v("sudo systemctl status glance-api")]),s._v(" "),t("p",[s._v("source admin-openrc-fish.sh")]),s._v(" "),t("p",[s._v("wget http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img")]),s._v(" "),t("p",[s._v("pwd")]),s._v(" "),t("p",[s._v("/home/qtz")]),s._v(" "),t("p",[s._v('glance image-create --name "cirros0.4.0" '),t("br"),s._v("\n--file /home/qtz/cirros-0.4.0-x86_64-disk.img "),t("br"),s._v("\n--disk-format qcow2 --container-format bare "),t("br"),s._v("\n--visibility=public")]),s._v(" "),t("p",[s._v("glance image-list")]),s._v(" "),t("p",[s._v('openstack service list |grep -E "ID|glance"')]),s._v(" "),t("p",[s._v('openstack endpoint list |grep -E "ID|glance"')]),s._v(" "),t("p",[s._v('openstack user list |grep -E "ID|glance"')]),s._v(" "),t("p",[s._v('openstack service list |grep -E "ID|glance" | wc -l\n2')]),s._v(" "),t("p",[s._v('openstack endpoint list |grep -E "ID|glance" | wc -l\n4')]),s._v(" "),t("p",[s._v('openstack user list |grep -E "ID|glance" | wc -l\n2')]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u glance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" glance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("disk_format"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("created_at "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" images"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);