(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{482:function(t,a,s){"use strict";s.r(a);var e=s(1),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h3",{attrs:{id:"目标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目标"}},[t._v("#")]),t._v(" 目标：")]),t._v(" "),a("h3",{attrs:{id:"实现clash中配置wireguard-能够只开mihomo就能实现异地组网"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现clash中配置wireguard-能够只开mihomo就能实现异地组网"}},[t._v("#")]),t._v(" 实现clash中配置wireguard，能够只开mihomo就能实现异地组网")]),t._v(" "),a("p",[t._v("设备："),a("br"),t._v("\n服务器：Ubuntu22.04"),a("br"),t._v("\nPC：Windows 11"),a("br"),t._v("\n平板：matepad pro 11 冤种2022款"),a("br"),t._v("\n手机：p30pro"),a("br")]),t._v(" "),a("p",[t._v("登录服务器，更新源，开放防火墙端口")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("apt update\napt install wireguard ufw\nufw allow 51820/tcp\nufw allow 51820/udp\n")])])]),a("p",[t._v("生成WireGuard公钥和私钥：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("wg genkey "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" priv_key "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" wg pubkey "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" priv_key "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" pub_key "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"here is priv_key:"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" priv_key "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"here is pub_key:"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" pub_key "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" priv_key pub_key\n")])])]),a("p",[t._v("编辑wg0配置文件")]),t._v(" "),a("p",[t._v("vi /etc/wireguard/wg0.conf")]),t._v(" "),a("p",[t._v("示例配置文件：")]),t._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("Interface")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("Address")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("10.0.0.1/32 #我的服务器的虚拟局域网的IP /32对应255.255.255.255的子网掩码")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("ListenPort")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("51820")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PrivateKey")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1234567890VKjsfhlkwefhliiwehfliwehfwe=")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostUp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -I FORWARD -i wg0 -j ACCEPT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostUp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -I FORWARD -o wg0 -j ACCEPT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostUp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -t nat -A POSTROUTING -s 10.0.0.0/24 -o eth0 -j MASQUERADE")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostUp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -t nat -A POSTROUTING -s 192.168.6.0/24 -o eth0 -j MASQUERADE")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostUp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -A INPUT -p udp -m udp --dport 51820 -j ACCEPT")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostDown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -D FORWARD -i wg0 -j ACCEPT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostDown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -D FORWARD -o wg0 -j ACCEPT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostDown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -t nat -D POSTROUTING -s 10.0.0.0/24 -o eth0 -j MASQUERADE")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostDown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -t nat -D POSTROUTING -s 192.168.6.0/24 -o eth0 -j MASQUERADE")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostDown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -D INPUT -p udp -m udp --dport 51820 -j ACCEPT")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("Peer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PublicKey")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("oooooooshfiashfefjerieroijgtnbsdoferrigo=")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("AllowedIPs")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("10.0.0.2/32")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("Peer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PublicKey")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("8282882828282sfrfewrfewrfoitrgkbfodgbhiegrhr=")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("AllowedIPs")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("10.0.0.3/32")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("Peer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PublicKey")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("pppppppppioetjhgtibtenbpetjbboptrjbirtbijbt=")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("AllowedIPs")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("10.0.0.4/32")]),t._v("\n")])])]),a("p",[t._v("按下ESC，输入:wq保存并退出配置文件")]),t._v(" "),a("p",[t._v("按照wg0配置快速启动WireGuard命令：")]),t._v(" "),a("p",[a("code",[t._v("wg-quick up wg0")])]),t._v(" "),a("p",[t._v("添加WireGuard的wg0配置文件的开机自动启动命令：")]),t._v(" "),a("p",[a("code",[t._v("systemctl enable wg-quick@wg0.service")])]),t._v(" "),a("p",[t._v("如果你修改了配置你可以这样快速重启WireGuard")]),t._v(" "),a("p",[a("code",[t._v("wg-quick down wg0 && wg-quick up wg0")])]),t._v(" "),a("p",[t._v("在mihomo中的配置：")]),t._v(" "),a("p",[t._v("merge file：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prepend-proxies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wg"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" wireguard\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("private-key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 8282882828282sfrfewrfewrfoitrgkbfodgbhiegrhr\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 8.138.130.196\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("51820")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ip")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.2\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("public-key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 8282882828282sfrfewrfewrfoitrgkbfodgbhiegrhr\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("allowed-ips")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.0.0.0/0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("udp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("1.1.1.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 8.8.8.8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("Windows WireGuard终端配置：")]),t._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("Interface")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PrivateKey")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("hruiufuehrfheriferhfiwjffjlwrwjgffwrhfr=")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("Address")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("10.0.0.2/32")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("Peer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PublicKey")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iwfhiwrfiwjrfljhjgoerjogjeroigjoerjgojwrg=")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("AllowedIPs")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("10.0.0.0/24, 192.168.6.0/24")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("Endpoint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("8.138.130.196:51820")]),t._v("\n\n")])])]),a("p",[t._v("你以为结束了？并没有，接下来是踩坑历史和详细的说明：")]),t._v(" "),a("p",[t._v("在刚开始的时候，我天真地以为，只要配置成这样就好了：")]),t._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("Interface")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("Address")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("10.0.0.1/32")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("ListenPort")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("51820 #WireGuard端口号")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PrivateKey")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1111111hfrhflihewrilfhilerhfliehrf= #服务器的WireGuard私钥")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostUp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -I FORWARD -s 10.0.0.0/24 -i wg0 -d 10.0.0.0/24 -j ACCEPT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostUp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -I FORWARD -s 10.0.0.0/24 -i wg0 -d 192.168.6.0/24 -j ACCEPT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostUP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -I FORWARD -s 192.168.6.0/24 -i wg0 -d 10.0.0.0/24 -j ACCEPT")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostDown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -D FORWARD -s 10.0.0.0/24 -i wg0 -d 10.0.0.0/24 -j ACCEPT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostDown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -D FORWARD -s 10.0.0.0/24 -i wg0 -d 192.168.6.0/24 -j ACCEPT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostDown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -D FORWARD -s 192.168.6.0/24 -i wg0 -d 10.0.0.0/24 -j ACCEPT")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("Peer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PublicKey")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("oooooooooojdlsgjitgjtgicWmwhkfrehfherfher= #客户端1的公钥  在客户端1需要填上你公钥对应的私钥")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("AllowedIPs")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("10.0.0.2/32")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("Peer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PublicKey")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("mmmmmmhiroghjetgetoigjeitjgioejtiijeg= #客户端2的公钥  在客户端2需要填上你公钥对应的私钥")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("AllowedIPs")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("10.0.0.3/32")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("Peer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PublicKey")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("kkkkkkkkkkhfrhfoerhfoierhferfreghogh= #客户端3的公钥  在客户端3需要填上你公钥对应的私钥")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("AllowedIPs")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("10.0.0.4/32")]),t._v("\n\n")])])]),a("p",[t._v("客户端配置保持不变。")]),t._v(" "),a("p",[t._v("启动WireGuard，配置好客户端，一切看上去非常顺利，WireGuard客户端也连上了服务器，也成功的握手了")]),t._v(" "),a("p",[t._v("而且我在10.0.0.1 、10.0.0.2 、10.0.0.3互相ping对方，也非常的顺利，没有任何问题。")]),t._v(" "),a("p",[t._v("but，当我启动parsec的时候 parsec 800 报错")]),t._v(" "),a("p",[t._v("为什么？")]),t._v(" "),a("p",[t._v("fail to request /web/json")]),t._v(" "),a("p",[t._v("看起来它获取不到这个文件，但是我都是可以ping通的")]),t._v(" "),a("p",[t._v("在经过了不断地排错后，我意识到，会不会我的虚拟局域网根本就访问不了外部网络？")]),t._v(" "),a("p",[t._v("有道理")]),t._v(" "),a("p",[t._v("于是将配置的路由表进行修改，使用NAT转发流量，这样就可以实现访问外部网络了。")]),t._v(" "),a("p",[t._v("路由表配置部分：")]),t._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostUp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -I FORWARD -i wg0 -j ACCEPT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#作用: 允许所有通过 wg0 接口进入的流量进行转发。")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostUp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -I FORWARD -o wg0 -j ACCEPT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#作用: 允许所有通过 wg0 接口发出的流量进行转发。")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostUp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -t nat -A POSTROUTING -s 10.0.0.0/24 -o eth0 -j MASQUERADE")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#作用: 为源地址为 10.0.0.0/24 的流量在通过 eth0 接口时进行地址伪装（NAT）。它确保来自 10.0.0.0/24 子网的流量在通过外部接口 eth0 时使用NAT。")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostUp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -t nat -A POSTROUTING -s 192.168.6.0/24 -o eth0 -j MASQUERADE")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#作用: 为源地址为 192.168.6.0/24 的流量在通过 eth0 接口时进行地址伪装（NAT）。它确保来自 192.168.6.0/24 子网的流量在通过外部接口 eth0 时使用NAT。")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostUp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -A INPUT -p udp -m udp --dport 51820 -j ACCEPT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#作用: 允许所有发往UDP端口 51820 的流量。它确保WireGuard所使用的UDP端口 51820 的流量被允许进入。")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostDown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -D FORWARD -i wg0 -j ACCEPT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除Postup对应的规则")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostDown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -D FORWARD -o wg0 -j ACCEPT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除Postup对应的规则")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostDown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -t nat -D POSTROUTING -s 10.0.0.0/24 -o eth0 -j MASQUERADE")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除Postup对应的规则")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostDown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -t nat -D POSTROUTING -s 192.168.6.0/24 -o eth0 -j MASQUERADE")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除Postup对应的规则")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("PostDown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("iptables -D INPUT -p udp -m udp --dport 51820 -j ACCEPT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除Postup对应的规则")]),t._v("\n")])])]),a("p",[t._v("修改完成后，将WireGuard重新启动。")]),t._v(" "),a("p",[t._v("这次它十分符合预期，一切正常。")]),t._v(" "),a("p",[t._v("parsec正常工作，我可以远程连接我的Windows电脑，而且不用开启WireGuard客户端，单单开启clash即可。")])])}),[],!1,null,null,null);a.default=n.exports}}]);